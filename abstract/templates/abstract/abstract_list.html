{% extends 'core/base.html' %}

{% block body %}
  <div id='{{ abstract.id }}-list-container' class="container">
    <h1>Abstracts</h1>
    <p>Below is a summary of all abstracts. Click 'include' to mark an abstract
      as included in the conference, 'Save' to save these changes to the database, or 'Show plots'
      for a preview of what the updated demographic statistics will look like.
    </p>
    <br>
    {% if abstract_list.count %}
      <table id="abstract-table" class="table table-hover">
        <thead>
          <th style="min-width: 200px">Title</th>
          <th>Submitter</th>
          <th>Keywords</th>
          <th>Categories</th>
          {% if show_demographics %}
            <th>Career Stage</th>
            <th>Gender</th>
            <th>Aboriginal or Torres Straight Islander</th>
            <th>State</th>
          {% endif %}
          <th>Review Count</th>
          <th>Averaged score</th>
          <th>Include</th>
        </thead>
        <tbody>
          {% for abstract in abstract_list.all %}
            <tr>
              <td><a href="{% url 'abstract:abstract_summary' abstract.id %}">{{ abstract.title }}</a></td>
              <td>{{ abstract.submitter.profile.display_name }}</td>
              <td>{{ abstract.keywords.all|join:", "|default:"-" }}</td>
              <td>{{ abstract.categories.all|join:", "|default:"-" }}</td>
              {% if show_demographics %}
                <td>{{ abstract.submitter.profile.career_stage.text|default:"-" }} </td>
                <td>{{ abstract.submitter.profile.gender.text|default:"-" }} </td>
                <td>{{ abstract.submitter.profile.aboriginal_or_torres.text|default:"-" }} </td>
                <td>{{ abstract.submitter.profile.state.text|default:"-" }} </td>
              {% endif %}
              <td>{{ abstract.reviews.count|default:"-" }} </td>
              <td>{{ abstract.score|stringformat:"#.3g"|default:"-" }} </td>
              <td>
                <input type="checkbox" value="{{ abstract.id }}" {% if abstract.approved %}checked{% endif %}/>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No abstracts have been submitted</p>
    {% endif %}
  </div>

  <div class="container">
    {% if ASSIGNER_GROUP in request.user.profile.group_names %}
      <hr>
      <a class="btn btn-outline-danger mt-1"
         href="{% url 'abstract:abstract_list' %}?show_demographics=True">
        Show demographics
      </a>
      <a class="btn btn-outline-danger mt-1"
         href="{% url 'abstract:abstract_list' %}">
        Hide demographics
      </a>
    {% endif %}
  </div>

{% endblock %}


{% block extra_scripts %}
<script type="text/javascript">
  $("document").ready(function() {
    let table = $("#abstract-table").DataTable({
      responsive: true,
      scrollX: true,
      paging: false,
    });
  });
</script>
{% endblock %}